

############################################################################################################
CND                       = require 'cnd'
rpr                       = CND.rpr
badge                     = 'MULTIMIX/TESTS'
log                       = CND.get_logger 'plain',     badge
info                      = CND.get_logger 'info',      badge
whisper                   = CND.get_logger 'whisper',   badge
alert                     = CND.get_logger 'alert',     badge
debug                     = CND.get_logger 'debug',     badge
warn                      = CND.get_logger 'warn',      badge
help                      = CND.get_logger 'help',      badge
urge                      = CND.get_logger 'urge',      badge
echo                      = CND.echo.bind CND
#...........................................................................................................
test                      = require 'guy-test'
#...........................................................................................................
{ mix }                   = require './main'


#===========================================================================================================
# HELPERS
#-----------------------------------------------------------------------------------------------------------
s = ( x ) -> JSON.stringify x, null, '  '
t = ( x ) -> JSON.stringify x

#-----------------------------------------------------------------------------------------------------------
@_prune = ->
  for name, value of @
    continue if name.startsWith '_'
    delete @[ name ] unless name in include
  return null

#-----------------------------------------------------------------------------------------------------------
@_main = ->
  test @, 'timeout': 3000


#===========================================================================================================
# TESTS
#-----------------------------------------------------------------------------------------------------------
@[ "demo (1)" ] = ( T ) ->
  #.........................................................................................................
  test_tools = ( T, x ) ->
    return T.fail "object has no property 'tools'" unless x.tools?
    T.ok x.tools[ key ]? for key in [ 'normalize_tag', 'unique', 'append', 'meld', 'reduce_tag', ]
    return null
  #.........................................................................................................
  test_tools T, mix
  my_mix = mix.use { primes: 'append' }
  test_tools T, my_mix
  # debug '©68279', ( key for key of mix )
  # debug '©68279', ( key for key of my_mix )
  # debug '©99418', t mix.reducers
  #.........................................................................................................
  a =
    id:           'a'
    primes:       [ 2, 3, 5, 7, ]
    report:       -> t { @id, @primes, }
  #.........................................................................................................
  b = my_mix a, { id: 'b', primes: [ 13, 17, 23, ], }
  #.........................................................................................................
  info '©09344', mix
  urge '©45237', my_mix
  info '©82977', 'a', a
  urge '©56112', 'b', b
  T.eq a[ 'primes' ], [2,3,5,7]
  T.eq b[ 'primes' ], [2,3,5,7,13,17,23]
  T.eq a.report(), '{"id":"a","primes":[2,3,5,7]}'
  T.eq b.report(), '{"id":"b","primes":[2,3,5,7,13,17,23]}'
  #.........................................................................................................
  return null




############################################################################################################
unless module.parent?
  # debug '0980', JSON.stringify ( Object.keys @ ), null, '  '
  include = [
    "demo (1)"
    ]
  @_prune()
  @_main()


